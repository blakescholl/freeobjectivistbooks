<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>Class: Donation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/donation.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">ActiveRecord::Base
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-active-3F">#active?</a>
    
    <li><a href="#method-i-can_cancel-3F">#can_cancel?</a>
    
    <li><a href="#method-i-can_flag-3F">#can_flag?</a>
    
    <li><a href="#method-i-can_send-3F">#can_send?</a>
    
    <li><a href="#method-i-cancel">#cancel</a>
    
    <li><a href="#method-i-donor">#donor</a>
    
    <li><a href="#method-i-donor_can_cancel-3F">#donor_can_cancel?</a>
    
    <li><a href="#method-i-donor_cannot_be_requester">#donor_cannot_be_requester</a>
    
    <li><a href="#method-i-fix">#fix</a>
    
    <li><a href="#method-i-flag">#flag</a>
    
    <li><a href="#method-i-flag_message">#flag_message</a>
    
    <li><a href="#method-i-in_transit-3F">#in_transit?</a>
    
    <li><a href="#method-i-needs_address-3F">#needs_address?</a>
    
    <li><a href="#method-i-needs_fix-3F">#needs_fix?</a>
    
    <li><a href="#method-i-needs_sending-3F">#needs_sending?</a>
    
    <li><a href="#method-i-read-3F">#read?</a>
    
    <li><a href="#method-i-read_at">#read_at</a>
    
    <li><a href="#method-i-reading-3F">#reading?</a>
    
    <li><a href="#method-i-received-3F">#received?</a>
    
    <li><a href="#method-i-received_at">#received_at</a>
    
    <li><a href="#method-i-sent-3F">#sent?</a>
    
    <li><a href="#method-i-sent_at">#sent_at</a>
    
    <li><a href="#method-i-status">#status</a>
    
    <li><a href="#method-i-student">#student</a>
    
    <li><a href="#method-i-student_can_cancel-3F">#student_can_cancel?</a>
    
    <li><a href="#method-i-update_status">#update_status</a>
    
    <li><a href="#method-i-updated_at_for_status">#updated_at_for_status</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Admin.html">Admin</a>
  
    <li><a href="./Admin/CampaignTargetsController.html">Admin::CampaignTargetsController</a>
  
    <li><a href="./Admin/DonationsController.html">Admin::DonationsController</a>
  
    <li><a href="./Admin/EventsController.html">Admin::EventsController</a>
  
    <li><a href="./Admin/PledgesController.html">Admin::PledgesController</a>
  
    <li><a href="./Admin/ReferralsController.html">Admin::ReferralsController</a>
  
    <li><a href="./Admin/RequestsController.html">Admin::RequestsController</a>
  
    <li><a href="./Admin/ReviewsController.html">Admin::ReviewsController</a>
  
    <li><a href="./Admin/TestimonialsController.html">Admin::TestimonialsController</a>
  
    <li><a href="./Admin/UsersController.html">Admin::UsersController</a>
  
    <li><a href="./Reminders.html">Reminders</a>
  
    <li><a href="./Reminders/ConfirmReceipt.html">Reminders::ConfirmReceipt</a>
  
    <li><a href="./Reminders/ConfirmReceiptUnsent.html">Reminders::ConfirmReceiptUnsent</a>
  
    <li><a href="./Reminders/FulfillPledge.html">Reminders::FulfillPledge</a>
  
    <li><a href="./Reminders/ReadBooks.html">Reminders::ReadBooks</a>
  
    <li><a href="./Reminders/SendBooks.html">Reminders::SendBooks</a>
  
    <li><a href="./Mailgun.html">Mailgun</a>
  
    <li><a href="./Mailgun/Base.html">Mailgun::Base</a>
  
    <li><a href="./Mailgun/Campaign.html">Mailgun::Campaign</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./User/AuthTokenExpired.html">User::AuthTokenExpired</a>
  
    <li><a href="./User/AuthTokenInvalid.html">User::AuthTokenInvalid</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AnnouncementMailer.html">AnnouncementMailer</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./ApplicationMailer.html">ApplicationMailer</a>
  
    <li><a href="./ApplicationMailerHelper.html">ApplicationMailerHelper</a>
  
    <li><a href="./CampaignMailer.html">CampaignMailer</a>
  
    <li><a href="./CampaignTarget.html">CampaignTarget</a>
  
    <li><a href="./Donation.html">Donation</a>
  
    <li><a href="./DonationsController.html">DonationsController</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./Event.html">Event</a>
  
    <li><a href="./EventMailer.html">EventMailer</a>
  
    <li><a href="./FalseClass.html">FalseClass</a>
  
    <li><a href="./FlagsController.html">FlagsController</a>
  
    <li><a href="./ForbiddenException.html">ForbiddenException</a>
  
    <li><a href="./Geocoder.html">Geocoder</a>
  
    <li><a href="./Hash.html">Hash</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./Integer.html">Integer</a>
  
    <li><a href="./Location.html">Location</a>
  
    <li><a href="./LocationsController.html">LocationsController</a>
  
    <li><a href="./MessagesController.html">MessagesController</a>
  
    <li><a href="./MessagesHelper.html">MessagesHelper</a>
  
    <li><a href="./Metrics.html">Metrics</a>
  
    <li><a href="./NilClass.html">NilClass</a>
  
    <li><a href="./PasswordsController.html">PasswordsController</a>
  
    <li><a href="./Pledge.html">Pledge</a>
  
    <li><a href="./ProfileController.html">ProfileController</a>
  
    <li><a href="./Referral.html">Referral</a>
  
    <li><a href="./Reminder.html">Reminder</a>
  
    <li><a href="./ReminderEntity.html">ReminderEntity</a>
  
    <li><a href="./ReminderJob.html">ReminderJob</a>
  
    <li><a href="./ReminderMailer.html">ReminderMailer</a>
  
    <li><a href="./Request.html">Request</a>
  
    <li><a href="./RequestsController.html">RequestsController</a>
  
    <li><a href="./RequestsHelper.html">RequestsHelper</a>
  
    <li><a href="./Review.html">Review</a>
  
    <li><a href="./SessionsController.html">SessionsController</a>
  
    <li><a href="./StatusesController.html">StatusesController</a>
  
    <li><a href="./String.html">String</a>
  
    <li><a href="./TestController.html">TestController</a>
  
    <li><a href="./Testimonial.html">Testimonial</a>
  
    <li><a href="./TestimonialsController.html">TestimonialsController</a>
  
    <li><a href="./Time.html">Time</a>
  
    <li><a href="./TrueClass.html">TrueClass</a>
  
    <li><a href="./UnauthorizedException.html">UnauthorizedException</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Donation</h1>

  <div id="description" class="description">
    
<p>Represents a donor’s granting of a student’s request (or stated intention
to do so).</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-active-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">active?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Whether the donation is still active, i.e., not canceled.</p>
          

          
          <div class="method-source-code" id="active-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">active?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">canceled?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- active-3F-source -->
          
        </div>

        

        
      </div><!-- active-3F-method -->

    
      <div id="method-i-can_cancel-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_cancel?</span><span
            class="method-args">(user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the given user can cancel the donation.</p>
          

          
          <div class="method-source-code" id="can_cancel-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_cancel?</span>(<span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">user</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">donor</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">donor_can_cancel?</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">student</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">student_can_cancel?</span>
  <span class="ruby-keyword">else</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_cancel-3F-source -->
          
        </div>

        

        
      </div><!-- can_cancel-3F-method -->

    
      <div id="method-i-can_flag-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_flag?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if we should show the “flag” link to the donor.</p>
          

          
          <div class="method-source-code" id="can_flag-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_flag?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">sent?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">flagged?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_flag-3F-source -->
          
        </div>

        

        
      </div><!-- can_flag-3F-method -->

    
      <div id="method-i-can_send-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_send?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if we should show the “sent” button to the donor.</p>
          

          
          <div class="method-source-code" id="can_send-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_send?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">sent?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_send-3F-source -->
          
        </div>

        

        
      </div><!-- can_send-3F-method -->

    
      <div id="method-i-cancel" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cancel</span><span
            class="method-args">(params, user)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="cancel-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cancel</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">canceled?</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Can't cancel&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">can_cancel?</span> <span class="ruby-identifier">user</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">canceled</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">donation</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>
    <span class="ruby-identifier">request</span>.<span class="ruby-identifier">donation</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">cancel_donation_events</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">user</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cancel-source -->
          
        </div>

        

        
      </div><!-- cancel-method -->

    
      <div id="method-i-donor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">donor</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Alias for the user who made the donation.</p>
          

          
          <div class="method-source-code" id="donor-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">donor</span>
  <span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- donor-source -->
          
        </div>

        

        
      </div><!-- donor-method -->

    
      <div id="method-i-donor_can_cancel-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">donor_can_cancel?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the donor can cancel the donation.</p>
          

          
          <div class="method-source-code" id="donor_can_cancel-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">donor_can_cancel?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">received?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- donor_can_cancel-3F-source -->
          
        </div>

        

        
      </div><!-- donor_can_cancel-3F-method -->

    
      <div id="method-i-donor_cannot_be_requester" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">donor_cannot_be_requester</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="donor_cannot_be_requester-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">donor_cannot_be_requester</span>
  <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-value">:base</span>, <span class="ruby-string">&quot;You can't donate to yourself!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">donor</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">student</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- donor_cannot_be_requester-source -->
          
        </div>

        

        
      </div><!-- donor_cannot_be_requester-method -->

    
      <div id="method-i-fix" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fix</span><span
            class="method-args">(attributes, event_attributes = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="fix-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fix</span>(<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">event_attributes</span> = {})
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">attributes</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">flagged</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">fix_events</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">event_attributes</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">detail</span><span class="ruby-operator">:</span> <span class="ruby-identifier">student</span>.<span class="ruby-identifier">update_detail</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- fix-source -->
          
        </div>

        

        
      </div><!-- fix-method -->

    
      <div id="method-i-flag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">flag</span><span
            class="method-args">(params)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="flag-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 223</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">flag</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">flagged</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">flag_events</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">params</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- flag-source -->
          
        </div>

        

        
      </div><!-- flag-method -->

    
      <div id="method-i-flag_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">flag_message</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>The message from the donor the last time the donor flagged the request, if
any.</p>
          

          
          <div class="method-source-code" id="flag_message-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">flag_message</span>
  <span class="ruby-identifier">event</span> = <span class="ruby-identifier">flag_events</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">event</span>.<span class="ruby-identifier">message</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">event</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- flag_message-source -->
          
        </div>

        

        
      </div><!-- flag_message-method -->

    
      <div id="method-i-in_transit-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">in_transit?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the book has been sent but not yet received.</p>
          

          
          <div class="method-source-code" id="in_transit-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">in_transit?</span>
  <span class="ruby-identifier">status</span>.<span class="ruby-identifier">sent?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- in_transit-3F-source -->
          
        </div>

        

        
      </div><!-- in_transit-3F-method -->

    
      <div id="method-i-needs_address-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">needs_address?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Whether we’re going to require the student to enter an address the next
time they update the associated request.</p>
          

          
          <div class="method-source-code" id="needs_address-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">needs_address?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">flagged?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sent?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- needs_address-3F-source -->
          
        </div>

        

        
      </div><!-- needs_address-3F-method -->

    
      <div id="method-i-needs_fix-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">needs_fix?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Whether the donation has been flagged for the student to respond.</p>
          

          
          <div class="method-source-code" id="needs_fix-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">needs_fix?</span>
  <span class="ruby-identifier">active?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">flagged?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- needs_fix-3F-source -->
          
        </div>

        

        
      </div><!-- needs_fix-3F-method -->

    
      <div id="method-i-needs_sending-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">needs_sending?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the ball is in the donor’s court to send the book.</p>
          

          
          <div class="method-source-code" id="needs_sending-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">needs_sending?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">sent?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">flagged?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- needs_sending-3F-source -->
          
        </div>

        

        
      </div><!-- needs_sending-3F-method -->

    
      <div id="method-i-read-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the book has been read.</p>
          

          
          <div class="method-source-code" id="read-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read?</span>
  <span class="ruby-identifier">status</span>.<span class="ruby-identifier">read?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- read-3F-source -->
          
        </div>

        

        
      </div><!-- read-3F-method -->

    
      <div id="method-i-read_at" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_at</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>The time the book was confirmed read, if any.</p>
          

          
          <div class="method-source-code" id="read_at-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read_at</span>
  <span class="ruby-identifier">updated_at_for_status</span> <span class="ruby-string">&quot;read&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- read_at-source -->
          
        </div>

        

        
      </div><!-- read_at-method -->

    
      <div id="method-i-reading-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reading?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the book has been received but not yet read.</p>
          

          
          <div class="method-source-code" id="reading-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reading?</span>
  <span class="ruby-identifier">status</span>.<span class="ruby-identifier">received?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- reading-3F-source -->
          
        </div>

        

        
      </div><!-- reading-3F-method -->

    
      <div id="method-i-received-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">received?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the book has been received.</p>
          

          
          <div class="method-source-code" id="received-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">received?</span>
  <span class="ruby-identifier">status</span>.<span class="ruby-identifier">received?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">read?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- received-3F-source -->
          
        </div>

        

        
      </div><!-- received-3F-method -->

    
      <div id="method-i-received_at" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">received_at</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>The time the book was confirmed received, if any.</p>
          

          
          <div class="method-source-code" id="received_at-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">received_at</span>
  <span class="ruby-identifier">updated_at_for_status</span> <span class="ruby-string">&quot;received&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- received_at-source -->
          
        </div>

        

        
      </div><!-- received_at-method -->

    
      <div id="method-i-sent-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sent?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the book has been sent. (This is not the same as status = sent,
since it is still true after the book has been received.)</p>
          

          
          <div class="method-source-code" id="sent-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sent?</span>
  <span class="ruby-identifier">status</span>.<span class="ruby-identifier">sent?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">received?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">read?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sent-3F-source -->
          
        </div>

        

        
      </div><!-- sent-3F-method -->

    
      <div id="method-i-sent_at" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sent_at</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>The time the book was confirmed sent, if any.</p>
          

          
          <div class="method-source-code" id="sent_at-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sent_at</span>
  <span class="ruby-identifier">updated_at_for_status</span> <span class="ruby-string">&quot;sent&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sent_at-source -->
          
        </div>

        

        
      </div><!-- sent_at-method -->

    
      <div id="method-i-status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">status</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Status of the donation: not_sent, sent, received, or read, as a
StringInquirer.</p>
          

          
          <div class="method-source-code" id="status-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">status</span>
  <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">StringInquirer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>[<span class="ruby-value">:status</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- status-source -->
          
        </div>

        

        
      </div><!-- status-method -->

    
      <div id="method-i-student" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">student</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Student the donation is for.</p>
          

          
          <div class="method-source-code" id="student-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">student</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- student-source -->
          
        </div>

        

        
      </div><!-- student-method -->

    
      <div id="method-i-student_can_cancel-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">student_can_cancel?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>True if the student is allowed to cancel the donation.</p>
          

          
          <div class="method-source-code" id="student_can_cancel-3F-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">student_can_cancel?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sent?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">flagged?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">since</span>(<span class="ruby-identifier">created_at</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">3</span>.<span class="ruby-identifier">weeks</span>
  <span class="ruby-identifier">reminder</span> = <span class="ruby-identifier">reminders</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-constant">Reminders</span><span class="ruby-operator">::</span><span class="ruby-constant">SendBooks</span>).<span class="ruby-identifier">reorder</span>(<span class="ruby-value">:created_at</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">reminder</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">since</span>(<span class="ruby-identifier">reminder</span>.<span class="ruby-identifier">created_at</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">week</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- student_can_cancel-3F-source -->
          
        </div>

        

        
      </div><!-- student_can_cancel-3F-method -->

    
      <div id="method-i-update_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_status</span><span
            class="method-args">(params, time = Time.now)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_status-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_status</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>]
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status_updated_at</span> = <span class="ruby-identifier">time</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">flagged</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sent?</span>

  <span class="ruby-identifier">event_attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:event</span>] <span class="ruby-operator">||</span> {}
  <span class="ruby-identifier">event</span> = <span class="ruby-identifier">update_status_events</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">event_attributes</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">detail</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">event</span>.<span class="ruby-identifier">is_thanks</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">event</span>.<span class="ruby-identifier">public</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">event</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_status-source -->
          
        </div>

        

        
      </div><!-- update_status-method -->

    
      <div id="method-i-updated_at_for_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">updated_at_for_status</span><span
            class="method-args">(status)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="updated_at_for_status-source">
            <pre><span class="ruby-comment"># File app/models/donation.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">updated_at_for_status</span>(<span class="ruby-identifier">status</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">created_at</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;not_sent&quot;</span>

  <span class="ruby-identifier">event</span> = <span class="ruby-identifier">update_status_events</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">detail</span><span class="ruby-operator">:</span> <span class="ruby-identifier">status</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">event</span>
    <span class="ruby-identifier">event</span>.<span class="ruby-identifier">happened_at</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">status</span>
    <span class="ruby-identifier">updated_at</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- updated_at_for_status-source -->
          
        </div>

        

        
      </div><!-- updated_at_for_status-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.11.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

